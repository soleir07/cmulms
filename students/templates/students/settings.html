{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMU LMS - Parent Dashboard</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        
* { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f7fa;
            display: flex;
            height: 100vh;
            overflow-x: hidden;
        }
        .sidebar {
            width: 300px;
            background: linear-gradient(180deg, #1e40af 0%, #3b82f6 100%);
            box-shadow: 4px 0 20px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        .logo {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.1);
        }
        .logo img {
            width: 40px; height: 40px; margin-right: 12px; border-radius: 50%;
        }
        .cmu-logo {
            font-size: 1.0rem;
            font-weight: 700;
            color: white;
        }
        .nav-menu { flex: 1; padding: 16px 0; }
        .nav-item {
            display: flex; align-items: center; padding: 16px 24px;
            color: rgba(255,255,255,0.85);
            text-decoration: none; transition: all 0.3s ease;
            font-size: 0.95rem; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white; transform: translateX(5px);
        }
        .nav-item i { margin-right: 12px; color: #bfdbfe; }

        /**  drop down  **/

        .teaching-toggle {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          
          .dropdown-arrow {
            margin-left: auto;
          }
          
          .teaching-dropdown {
            display: none;
            flex-direction: column;
            background-color: linear-gradient(180deg, #1e40af 0%, #3b82f6 100%);
            padding-left: 30px;
            margin-top: 5px;
          }
          
          .dropdown-item {
            padding: 8px 0;
            color: #f5f7fa;
            text-decoration: none;
            font-size: 14px;
          }
          
          .dropdown-item:hover {
            background: rgba(255,255,255,0.15);
            color: white; transform: translateX(5px);
          }

          /** **/

          .nav-item i { margin-right: 12px; color: #bfdbfe; }
          .main-content { flex: 1; display: flex; flex-direction: column; }
          .header {
            background: #fff; padding: 12px 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }
        .search-bar input {
            padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px;
            outline: none; font-size: 0.9rem; width: 200px;
        }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .notification-icon { color: #f59e0b; font-size: 1.2rem; cursor: pointer; }
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .content-area { flex: 1; padding: 24px; overflow-y: auto; }
        .welcome-banner {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white; padding: 24px; border-radius: 14px; margin-bottom: 24px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .welcome-content h2 { font-size: 1.6rem; margin-bottom: 6px; }

       /*drop down in profile*/
       .user-profile {
    position: relative;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
}
.user-profile .user-avatar img {
    width: 37px;
    height: 37px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #4e54c8;
}
.avatar-dropdown-menu {
    display: none;
    flex-direction: column;
    position: absolute;
    top: 100%; right: 0;
    background: #fff;
    min-width: 120px;
    border-radius: 8px;
    box-shadow: 0 4px 14px rgba(0,0,0,.15);
    z-index: 1001;
    margin-top: 8px;
    padding: 8px 0;
}
.avatar-dropdown-menu a {
    display: flex; align-items: center;
    gap: 7px;
    padding: 8px 16px;
    color: #333;
    text-decoration: none;
    font-size: 14px;
    transition: background 0.17s;
}
.avatar-dropdown-menu a:hover {
    background: #f2f2f2;
}


/*account info*/

.card {
  transition: box-shadow 0.2s;
}
.card:hover {
  box-shadow: 0 8px 32px rgba(59, 130, 246, 0.15);
}
input[type="email"], input[type="password"], input[type="text"] {
  transition: box-shadow 0.17s, border-color 0.17s;
}
input[type="email"]:focus, input[type="password"]:focus, input[type="text"]:focus {
  box-shadow: 0 0 0 2px #3b82f6;
  border-color: #3b82f6;
}
.btn-outline-primary:hover, .btn-outline-secondary:hover {
  background: #3b82f6;
  color: #fff;
}
.btn-warning:hover {
  background: #8b5cf6;
  color: #fff;
  border-color: #8b5cf6;
}
.btn-outline-danger:hover {
  background: #dc3545;
  color: #fff;
}
label[for="profilePhoto"]:hover {
  background: #8b5cf6 !important;
}
.bg-gradient {
  background: linear-gradient(90deg,#3b82f6 0%,#8b5cf6 100%);
}
.card-header {
  border-top-left-radius: 1rem !important;
  border-top-right-radius: 1rem !important;
}
.card, .modal-content {
  border-radius: 1rem !important;
}
input.form-control, .btn {
  border-radius: 2rem !important;
}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="{% static 'images/cmu.jpg' %}" alt="CMU Logo">
            <div class="cmu-logo">City of Malabon University</div>
        </div>
        <nav class="nav-menu">
            <a href="" class="nav-item active"><i class="fas fa-layer-group"></i> Overview</a>
            <a href='' class="nav-item"><i class="fas fa-calendar"></i>Event Calendar</a>
            <!-- Teaching with Dropdown -->
    <div class="nav-item teaching-toggle" onclick="toggleTeachingDropdown()">
        <i class="fas fa-user"></i> My Student <i class="fas fa-chevron-down dropdown-arrow"></i>
      </div>
      <div class="teaching-dropdown" id="teachingDropdown">
        <a href="studentview.html" class="dropdown-item">
            <i class="fas fa-user-graduate course-icon"></i> Jan Rivera
        </a>
      </div>
        <a href="message.html" class="nav-item"><i class="fas fa-comments"></i>Messages</a>
        <a href="announcement.html" class="nav-item"><i class="fas fa-bullhorn"></i> Announcement</a>
        </nav>
        <a href="#" class="nav-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="search-bar"></div>
            <div class="header-right">
                <i class="fas fa-bell notification-icon"></i>
                <div class="user-profile">
                    <span>{{ user.first_name }}</span>
                    <div class="user-profile" id="userProfileDropdown">
                        <span>{{ user.first_name }}</span>
                        <div class="user-avatar" id="userAvatarBtn">
                            {% if user.profile_picture %}
                                <img src="{{ user.profile_picture.url }}" alt="User Avatar">
                            {% else %}
                                <img src="{% static 'images/user.jpg' %}" alt="User Avatar">
                            {% endif %}
                        </div>
                        <div class="avatar-dropdown-menu" id="avatarDropdownMenu">
                            <a href="{% url 'accounts:settings' %}"><i class="fas fa-cog"></i> Settings</a>
                            <a href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Account Info Section -->
<!-- Enhanced Account Info Section -->
<div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-7 col-md-9">
        <div class="card border-0 shadow-lg rounded-4">
          <!-- Gradient Header -->
          <div class="card-header bg-gradient text-white" style="background:linear-gradient(90deg,#3b82f6 0%,#8b5cf6 100%);">
            <h4 class="mb-0 d-flex align-items-center">
              <i class="fas fa-user-cog me-2"></i> Account Settings
            </h4>
          </div>
          <div class="card-body p-4">
            <!-- Profile & Username -->
            <div class="d-flex flex-column flex-md-row align-items-center mb-4">
              <div class="position-relative me-md-4 mb-3 mb-md-0">
                
                  <img src="{{ user.profile_picture.url }}" alt="Profile Photo" class="rounded-circle shadow" style="width:100px;height:100px;object-fit:cover;border:4px solid #3b82f6;">
              
                  <img src="{% static 'images/user.jpg' %}" alt="Profile Photo" class="rounded-circle shadow" style="width:100px;height:100px;object-fit:cover;border:4px solid #3b82f6;">
              
                <label for="profilePhoto" class="position-absolute bottom-0 end-0 bg-primary rounded-circle p-2" style="cursor:pointer;">
                  <i class="fas fa-camera text-white"></i>
                  <input type="file" id="profilePhoto" name="profile_photo" accept="image/*" class="d-none" onchange="this.form.submit()">
                </label>
              </div>
              <div class="flex-grow-1 ms-md-4">
                <form method="post" enctype="multipart/form-data" action="{% url 'accounts:change_profile_photo' %}">
                 
                  <button type="submit" class="btn btn-outline-primary btn-sm mt-2">Change Photo</button>
                </form>
                <form method="post" action="{% url 'accounts:change_username' %}" class="mt-3">
                  
                  <label class="form-label mb-1"><i class="fas fa-user"></i> Username</label>
                  <input type="text" class="form-control form-control-sm rounded-pill" name="username" value="{{ user.username }}" required>
                  <button type="submit" class="btn btn-outline-secondary btn-sm mt-2">Update Username</button>
                </form>
              </div>
            </div>
            <!-- User Info Row -->
            <div class="row mb-3 g-3">
              <div class="col-6">
                <div class="bg-light rounded-3 p-3 text-center shadow-sm">
                  <span class="text-primary fw-bold"><i class="fas fa-user-tag"></i> </span>
                </div>
              </div>
              <div class="col-6">
                <div class="bg-light rounded-3 p-3 text-center shadow-sm">
                  <span class="text-secondary"><i class="fas fa-calendar-day"></i> Joined: user.date_joined|date:"M d, Y</span>
                </div>
              </div>
              <div class="col-12">
                <div class="bg-light rounded-3 p-3 text-center shadow-sm">
                  <span class="text-success"><i class="fas fa-clock"></i> Last Login: user.last_login|date:"M d, Y H:i" </span>
                </div>
              </div>
            </div>
            <hr>
            <div class="row g-4">
              <!-- Email -->
              <div class="col-md-6">
                <h6 class="text-secondary mb-3"><i class="fas fa-envelope me-1"></i> Change Email</h6>
                <form method="post" action="">
              
                  <input type="email" class="form-control rounded-pill mb-2" name="email" value="{{ user.email }}" required>
                  <button type="submit" class="btn btn-primary w-100 rounded-pill">Update Email</button>
                </form>
              </div>
              <!-- Password -->
              <div class="col-md-6">
                <h6 class="text-secondary mb-3"><i class="fas fa-lock me-1"></i> Change Password</h6>
                <form method="post" action="">
        
                  <input type="password" class="form-control rounded-pill mb-2" name="old_password" placeholder="Current Password" required>
                  <input type="password" class="form-control rounded-pill mb-2" name="new_password1" placeholder="New Password" required>
                  <input type="password" class="form-control rounded-pill mb-2" name="new_password2" placeholder="Confirm New Password" required>
                  <button type="submit" class="btn btn-warning w-100 rounded-pill">Update Password</button>
                </form>
              </div>
            </div>
            <hr>
            <!-- Danger Zone -->
            <div class="mt-4">
              <h6 class="text-danger"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h6>
              <button class="btn btn-outline-danger w-100 rounded-pill" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fas fa-user-slash"></i> Delete Account
              </button>
              <!-- Delete Confirmation Modal -->
              <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content rounded-4">
                    <div class="modal-header bg-danger text-white">
                      <h5 class="modal-title" id="deleteModalLabel"><i class="fas fa-exclamation-triangle"></i> Confirm Delete</h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p>Are you sure you want to <b>delete your account</b>? This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                      <form method="post" action="">
                       
                        <button type="submit" class="btn btn-danger rounded-pill">Yes, Delete My Account</button>
                      </form>
                      <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Danger Zone -->
          </div>
        </div>
      </div>
    </div>
  </div>

       
    </div>
<script>
    function toggleTeachingDropdown() {
      const dropdown = document.getElementById("teachingDropdown");
      dropdown.style.display = dropdown.style.display === "flex" ? "none" : "flex";
    }

    // User avatar dropdown
const userAvatarBtn = document.getElementById("userAvatarBtn");
const avatarDropdownMenu = document.getElementById("avatarDropdownMenu");
const userProfileDropdown = document.getElementById("userProfileDropdown");

userAvatarBtn.addEventListener("click", function(e) {
    e.stopPropagation();
    avatarDropdownMenu.style.display = avatarDropdownMenu.style.display === "flex" ? "none" : "flex";
});

document.addEventListener("click", function(e) {
    if (!userProfileDropdown.contains(e.target)) {
        avatarDropdownMenu.style.display = "none";
    }
});
</script>
</body>
</html>